{"ast":null,"code":"var _jsxFileName = \"/Users/andrewyusuf/movie-rating-sideproject/src/pages/Home.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { db, auth, storage } from '../firebase';\nimport { getAuth, onAuthStateChanged } from \"firebase/auth\";\nimport styled from \"styled-components\";\nimport User from '../components/User';\nimport firebase from \"firebase/compat/app\";\nimport { query, onSnapshot, orderBy, collection, getDoc, updateDoc, doc } from \"firebase/firestore\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst HomeContainer = styled.div`\n    position: relative;\n    display: grid;\n    grid-template-columns: 1fr 3fr;\n    overflow: hidden;\n    height: calc(100vh - 70px);\n    width: 100vw;\n`;\n_c = HomeContainer;\nconst UserContainer = styled.div`\n    border-right: 2px solid #000000;\n    overflow-y: auto;\n`;\n_c2 = UserContainer;\nconst FeedContainter = styled.div`\n    position: relative;\n    // background-color: #F0F8FF;\n    background-color: #E6E6FA;\n    overflow-y: auto;\n    width: 100%;\n`;\n_c3 = FeedContainter;\nconst StyledH3 = styled.h3`\n    margin: 0;\n    padding: 10px;\n    text-align: center;\n    font-family: 'Dosis', sans-serif;\n    color: black;\n\n`;\n_c4 = StyledH3;\nexport const Home = () => {\n  _s();\n\n  var _auth$currentUser;\n\n  const [users, setUsers] = useState([]);\n  const [chat, setChat] = useState(\"\"); // this will hold the user that is being chatted with\n\n  const [messages, setMessages] = useState([]);\n  const user1 = (_auth$currentUser = auth.currentUser) === null || _auth$currentUser === void 0 ? void 0 : _auth$currentUser.uid;\n  useEffect(() => {\n    if (auth.currentUser) {\n      var _auth$currentUser2;\n\n      const usersRef = db.collection(\"users\"); // create query obj\n\n      usersRef.where('uid', 'not-in', [(_auth$currentUser2 = auth.currentUser) === null || _auth$currentUser2 === void 0 ? void 0 : _auth$currentUser2.uid]).get().then(querySnapshot => {\n        let users = [];\n        querySnapshot.forEach(doc => {\n          users.push(doc.data());\n        });\n        setUsers(users);\n      });\n    }\n  }, []);\n\n  const selectUser = async user => {\n    setChat(user);\n    console.log(user);\n    const user2 = user.uid;\n    const id = user1 > user2 ? `${user1 + user2}` : `${user2 + user1}`;\n    const messagesRef = collection(db, \"messages\", id, \"chat\");\n    const q = query(messagesRef, orderBy(\"createdAt\", \"asc\"));\n    onSnapshot(q, querySnapshot => {\n      let msgs = [];\n      querySnapshot.forEach(doc => {\n        msgs.push(doc.data());\n      });\n      setMessages(msgs);\n    }); // get last message between the loggen in user and the selected user\n\n    const docSnap = await getDoc(doc(db, \"lastMessage\", id)); // checking to see if the last message exists\n\n    if (docSnap.data() && docSnap.data().from !== user1) {\n      updateDoc(doc(db, \"lastMessage\", id), {\n        unread: false\n      });\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(HomeContainer, {\n    children: [/*#__PURE__*/_jsxDEV(UserContainer, {\n      children: users.map(user => /*#__PURE__*/_jsxDEV(User, {\n        user: user,\n        selectUser: selectUser,\n        chat: chat\n      }, user.uid, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 32\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(FeedContainter, {\n      children: /*#__PURE__*/_jsxDEV(StyledH3, {\n        children: \"Feed\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 13\n      }, this)\n    }, \"feed\", false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 93,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Home, \"7jM6NlSiKRPMQaApEoZS47jJCQg=\");\n\n_c5 = Home;\nexport default Home;\n\nvar _c, _c2, _c3, _c4, _c5;\n\n$RefreshReg$(_c, \"HomeContainer\");\n$RefreshReg$(_c2, \"UserContainer\");\n$RefreshReg$(_c3, \"FeedContainter\");\n$RefreshReg$(_c4, \"StyledH3\");\n$RefreshReg$(_c5, \"Home\");","map":{"version":3,"names":["React","useEffect","useState","db","auth","storage","getAuth","onAuthStateChanged","styled","User","firebase","query","onSnapshot","orderBy","collection","getDoc","updateDoc","doc","HomeContainer","div","UserContainer","FeedContainter","StyledH3","h3","Home","users","setUsers","chat","setChat","messages","setMessages","user1","currentUser","uid","usersRef","where","get","then","querySnapshot","forEach","push","data","selectUser","user","console","log","user2","id","messagesRef","q","msgs","docSnap","from","unread","map"],"sources":["/Users/andrewyusuf/movie-rating-sideproject/src/pages/Home.js"],"sourcesContent":["import React, {useEffect, useState} from 'react'\nimport {db, auth, storage} from '../firebase'\nimport { getAuth, onAuthStateChanged } from \"firebase/auth\";\nimport styled from \"styled-components\"\nimport User from '../components/User';\nimport firebase from \"firebase/compat/app\"\nimport {query, onSnapshot, orderBy, collection, getDoc, updateDoc, doc} from \"firebase/firestore\"\n\n\nconst HomeContainer = styled.div`\n    position: relative;\n    display: grid;\n    grid-template-columns: 1fr 3fr;\n    overflow: hidden;\n    height: calc(100vh - 70px);\n    width: 100vw;\n`\n\nconst UserContainer = styled.div`\n    border-right: 2px solid #000000;\n    overflow-y: auto;\n`\n\nconst FeedContainter = styled.div`\n    position: relative;\n    // background-color: #F0F8FF;\n    background-color: #E6E6FA;\n    overflow-y: auto;\n    width: 100%;\n`\n\nconst StyledH3 = styled.h3`\n    margin: 0;\n    padding: 10px;\n    text-align: center;\n    font-family: 'Dosis', sans-serif;\n    color: black;\n\n`\n\nexport const Home = () => {\n\n    const [users, setUsers] = useState([]);\n    const [chat, setChat] = useState(\"\");   // this will hold the user that is being chatted with\n    const [messages, setMessages] = useState([]);\n    const user1 = auth.currentUser?.uid;\n\n    useEffect(()=>{\n        if (auth.currentUser) {\n            const usersRef = db.collection(\"users\");\n            // create query obj\n            usersRef.where('uid', 'not-in', [auth.currentUser?.uid]).get().then((querySnapshot) => {\n                let users = []\n                querySnapshot.forEach(doc => {\n                    users.push(doc.data())\n                });\n                setUsers(users);\n            })\n\n        }\n            \n            \n    }, [])\n\n    const selectUser = async (user) => {\n        setChat(user);\n        console.log(user);\n\n        const user2 = user.uid;\n        const id = user1 > user2 ? `${user1 + user2}` : `${user2 + user1}`;\n\n        const messagesRef = collection(db, \"messages\", id, \"chat\");\n        const q = query(messagesRef, orderBy(\"createdAt\", \"asc\"));\n        onSnapshot(q, querySnapshot => {\n            let msgs = [];\n            querySnapshot.forEach(doc => {\n                msgs.push(doc.data());\n            })\n            setMessages(msgs);\n        })\n\n        // get last message between the loggen in user and the selected user\n        const docSnap = await getDoc(doc(db, \"lastMessage\", id));\n        // checking to see if the last message exists\n        if (docSnap.data() && docSnap.data().from !== user1) {\n            updateDoc(doc(db, \"lastMessage\", id), {\n                unread : false\n            })\n        }\n    }       \n\n  return (\n    <HomeContainer>\n        <UserContainer>\n            {users.map(user => <User key={user.uid} user={user} selectUser={selectUser} chat={chat}/>\n            )}\n        </UserContainer>\n        <FeedContainter key=\"feed\">\n            <StyledH3>Feed</StyledH3>\n\n        </FeedContainter>\n    </HomeContainer>\n    \n  )\n}\n\n\n\nexport default Home;"],"mappings":"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"},"metadata":{},"sourceType":"module"}